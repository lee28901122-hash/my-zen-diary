<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>æ›¾æ°ä¿®èº«é˜</title>
    <style>
        :root { --ink: #2c3e50; --paper: #fcfaf2; --accent: #8c4332; --border: #d1c7b7; }

        /* é’ˆå¯¹å¤§é™†ä¸»æµè®¾å¤‡çš„å­—ä½“é€‚é… */
        body {
            background: #e5e5e5;
            color: var(--ink);
            font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "STKaiti", serif;
            margin: 0; -webkit-tap-highlight-color: transparent;
        }

        .paper-bg {
            min-height: 100vh;
            background-color: var(--paper);
            background-image: url('https://www.transparenttextures.com/patterns/rice-paper-2.png');
            box-shadow: inset 0 0 100px rgba(0,0,0,0.05);
        }

        /* é¡¶éƒ¨å¯¼èˆªï¼šæ›´æœ‰è´¨æ„Ÿçš„æœ¨è´¨è‰²è°ƒ */
        nav {
            background: #4a2d26; padding: env(safe-area-inset-top) 0 10px 0;
            display: flex; justify-content: center; gap: 25px;
            position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        nav span { color: #d1c7b7; cursor: pointer; padding: 10px 5px; font-size: 16px; transition: 0.3s; position: relative; }
        nav span.active { color: #fff; font-weight: bold; }
        nav span.active::after { content: ''; position: absolute; bottom: 0; left: 20%; width: 60%; height: 2px; background: #fff; }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; box-sizing: border-box; }
        .page { display: none; }
        .page.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ä¹¦å·æ„Ÿè®¾è®¡ */
        .card {
            background: transparent; border: 1px solid var(--border);
            padding: 25px; margin-bottom: 20px; position: relative;
            background: rgba(255,255,255,0.3);
        }
        .seal { /* æ¨¡æ‹Ÿå°ç« æ•ˆæœ */
            position: absolute; right: 10px; top: 10px; width: 50px; height: 50px;
            border: 2px solid #8c4332; color: #8c4332; border-radius: 5px;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold; transform: rotate(15deg);
            opacity: 0.6; pointer-events: none;
        }

        h1 { text-align: center; color: var(--accent); font-family: "STKaiti", serif; letter-spacing: 4px; }

        .task-item { margin-bottom: 25px; }
        .task-label { font-weight: bold; color: var(--accent); margin-bottom: 12px; display: block; font-size: 15px; }

        /* ç§»åŠ¨ç«¯å‹å¥½çš„å¤§æŒ‰é’® */
        .btn-group { display: flex; gap: 12px; }
        .score-btn {
            flex: 1; padding: 15px 0; border: 1px solid var(--border);
            background: #fff; border-radius: 8px; cursor: pointer;
            font-family: inherit; font-size: 14px;
        }
        .score-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); transform: scale(1.05); }

        textarea {
            width: 100%; border: 1px solid var(--border); background: rgba(255,255,255,0.5);
            padding: 12px; font-family: inherit; font-size: 16px; border-radius: 8px;
            box-sizing: border-box; line-height: 1.6;
        }

        .btn-save {
            background: var(--accent); color: #fff; width: 100%; padding: 18px;
            border: none; border-radius: 30px; font-size: 18px; font-weight: bold;
            margin-top: 20px; box-shadow: 0 4px 15px rgba(140,67,50,0.3);
        }

        /* å†å²è®°å½•ç¾åŒ– */
        .history-card { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #eee; }
        .date-tag { display: inline-block; background: var(--accent); color: #fff; padding: 2px 10px; border-radius: 4px; font-size: 12px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="paper-bg">
    <nav>
        <span id="nav-write" class="active" onclick="showPage('write')">è®°æ—¥è¯¾</span>
        <span id="nav-history" onclick="showPage('history')">é˜…æ—§è´¦</span>
        <span id="nav-settings" onclick="showPage('settings')">å®šè§„çŸ©</span>
    </nav>

    <div class="container">
        <div id="page-write" class="page active">
            <h1>ä¿®èº«æ—¥è®°</h1>
            <div id="quote-display" style="text-align:center; font-style:italic; margin-bottom:20px; color:#666;"></div>

            <div class="card">
                <div class="seal">æ…ç‹¬</div>
                <label class="task-label">ğŸ“… æ—¥æœŸ</label>
                <input type="date" id="diary-date" style="width:100%; padding:10px; border:1px solid var(--border); border-radius:8px;">
            </div>

            <div id="dynamic-tasks"></div>

            <div class="card">
                <label class="task-label">âš¡ å¾—å¤±è‡ªçœ</label>
                <textarea id="reflection" rows="5" placeholder="è®°å½•ä»Šæ—¥ä¹‹è¿‡ï¼Œæ€æ˜æ—¥ä¹‹æ”¹..."></textarea>
            </div>

            <button class="btn-save" onclick="saveDiary()">å­˜æ¡ˆå­˜å¿ƒ</button>
        </div>

        <div id="page-history" class="page">
            <div id="history-list"></div>
        </div>

        <div id="page-settings" class="page">
            <div class="card">
                <h3>æ—¥è¯¾é…ç½®</h3>
                <div id="config-list"></div>
                <button onclick="addConfig()" style="width:100%; padding:12px; margin-top:15px; border:1px dashed var(--accent); background:none; color:var(--accent);">+ å¢åŠ ä¿®èº«é¡¹ç›®</button>
            </div>
        </div>
    </div>
</div>

<script>
    // é€»è¾‘ä¿æŒç¨³å®šå¹¶å¾®è°ƒä½“éªŒ
    let configs = JSON.parse(localStorage.getItem('zen_v6_configs')) || [
        { name: 'æ—©èµ· (é»æ˜å³èµ·)', type: 'score' },
        { name: 'è¯»ä¹¦ (æ¯æ—¥å¿…è¯»)', type: 'text' },
        { name: 'é™å (æ¯æ—¥ä¸æ‹˜æ—¶)', type: 'score' },
        { name: 'æƒ…ç»ª (ä¸è¨€äººé)', type: 'score' }
    ];
    let history = JSON.parse(localStorage.getItem('zen_v6_history')) || [];
    const quotes = ["ç™¾ç§å¼Šç—…ï¼Œçš†ä»æ‡’ç”Ÿã€‚", "ä¸ä¸ºåœ£è´¤ï¼Œä¾¿ä¸ºç¦½å…½ã€‚", "å‡¡äººåšä¸€äº‹ï¼Œä¾¿é¡»å…¨å‰¯ç²¾ç¥ã€‚", "å”¯å¤©ä¸‹ä¹‹è‡³è¯šï¼Œèƒ½èƒœå¤©ä¸‹ä¹‹è‡³ä¼ªã€‚"];

    function showPage(p) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('nav span').forEach(el => el.classList.remove('active'));
        document.getElementById('page-'+p).classList.add('active');
        document.getElementById('nav-'+p).classList.add('active');
        if(p === 'write') renderWrite();
        if(p === 'history') renderHistory();
        if(p === 'settings') renderSettings();
        window.scrollTo(0,0);
    }

    function renderWrite() {
        document.getElementById('quote-display').innerText = `â€œ${quotes[Math.floor(Math.random()*quotes.length)]}â€`;
        document.getElementById('diary-date').valueAsDate = new Date();
        const area = document.getElementById('dynamic-tasks');
        area.innerHTML = configs.map(cfg => `
            <div class="card">
                <label class="task-label">${cfg.name}</label>
                ${cfg.type === 'score' ? `
                    <div class="btn-group">
                        <button class="score-btn" data-name="${cfg.name}" data-val="1" onclick="selectScore(this)">ä¸åŠ</button>
                        <button class="score-btn" data-name="${cfg.name}" data-val="3" onclick="selectScore(this)">å°šå¯</button>
                        <button class="score-btn" data-name="${cfg.name}" data-val="5" onclick="selectScore(this)">ç²¾è¿›</button>
                    </div>
                ` : `
                    <textarea class="text-in" data-name="${cfg.name}" rows="2" placeholder="è¯¦æƒ…è®°å½•..."></textarea>
                `}
            </div>
        `).join('');
    }

    function selectScore(btn) {
        btn.parentElement.querySelectorAll('.score-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if(btn.dataset.val == 1) {
            const ref = document.getElementById('reflection');
            const name = btn.dataset.name;
            if(!ref.value.includes(name)) ref.value += `ã€${name}ã€‘æœªè¾¾æ ‡ï¼š`;
        }
    }

    function saveDiary() {
        const entry = {
            id: Date.now(),
            date: document.getElementById('diary-date').value,
            reflection: document.getElementById('reflection').value,
            scores: Array.from(document.querySelectorAll('.score-btn.active')).map(b => ({name: b.dataset.name, val: b.dataset.val})),
            texts: Array.from(document.querySelectorAll('.text-in')).map(i => ({name: i.dataset.name, val: i.value}))
        };
        history.unshift(entry);
        localStorage.setItem('zen_v6_history', JSON.stringify(history));
        alert("å­˜æ¡ˆæˆåŠŸï¼Œè‡ªçœè‡ªå¼ºï¼");
        showPage('history');
    }

    function renderHistory() {
        const list = document.getElementById('history-list');
        list.innerHTML = history.length === 0 ? '<p style="text-align:center; color:#999;">æš‚æ— è®°å½•ï¼Œä»Šæ—¥å¼€å§‹ä¿®èº«å§ã€‚</p >' :
        history.map(item => `
            <div class="history-card">
                <div class="date-tag">${item.date}</div>
                <div style="font-size:14px; color:#444;">
                    ${item.scores.map(s => `<b>${s.name}:</b> ${'â˜…'.repeat(s.val/1.5+1)}<br>`).join('')}
                    ${item.texts.map(t => `<b>${t.name}:</b> ${t.val}<br>`).join('')}
                    <div style="margin-top:8px; padding-top:8px; border-top:1px dashed #eee; color:var(--accent);">
                        <i>çœï¼š${item.reflection || 'æ— '}</i>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function renderSettings() {
        const list = document.getElementById('config-list');
        list.innerHTML = configs.map((c,i) => `
            <div style="display:flex; gap:10px; margin-bottom:15px; align-items:center;">
                <input type="text" value="${c.name}" onchange="updateCfg(${i},'name',this.value)" style="flex:2; padding:8px; border:1px solid #ddd;">
                <select onchange="updateCfg(${i},'type',this.value)" style="flex:1; padding:8px;">
                    <option value="score" ${c.type==='score'?'selected':''}>æ‰“åˆ†</option>
                    <option value="text" ${c.type==='text'?'selected':''}>å¡«ç©º</option>
                </select>
                <button onclick="delCfg(${i})" style="color:red; background:none; border:none; font-size:20px;">Ã—</button>
            </div>
        `).join('');
    }
    function updateCfg(i,k,v){ configs[i][k]=v; localStorage.setItem('zen_v6_configs', JSON.stringify(configs)); }
    function delCfg(i){ configs.splice(i,1); localStorage.setItem('zen_v6_configs', JSON.stringify(configs)); renderSettings(); }
    function addConfig(){ configs.push({name:'æ–°é¡¹ç›®', type:'score'}); renderSettings(); }

    renderWrite();
</script>
</body>
</html>
