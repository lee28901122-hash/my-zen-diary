<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>境·界 | 灵魂感知修正版</title>
    <style>
        :root { --zen-bg: #1a1a1a; --zen-ink: #fdfaf2; }
        
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: var(--zen-bg);
            font-family: "STKaiti", "KaiTi", serif;
            /* 关键：禁止系统长按菜单、禁止选中文本 */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: none; 
        }

        #canvas { position: absolute; top: 0; left: 0; z-index: 1; }

        .overlay {
            position: relative; z-index: 10;
            height: 100%; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            pointer-events: none;
        }

        #prompt-text {
            color: var(--zen-ink); font-size: 20px; letter-spacing: 5px;
            opacity: 0.5; transition: opacity 1s;
        }

        #mood-feedback {
            position: fixed; bottom: 60px; color: var(--zen-ink);
            font-size: 14px; opacity: 0.3; letter-spacing: 2px;
        }
    </style>
</head>
<body>

    <canvas id="canvas"></canvas>
    <div class="overlay">
        <p id="prompt-text">轻触屏幕，与此时的你对话</p >
        <p id="mood-feedback">正在感应心境...</p >
    </div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const prompt = document.getElementById('prompt-text');
    const feedback = document.getElementById('mood-feedback');

    let width, height, particles = [];
    let mouse = { x: -1000, y: -1000, active: false, startTime: 0 };

    class Particle {
        constructor() {
            this.reset();
        }
        reset() {
            this.x = Math.random() * width;
            this.y = Math.random() * height;
            // 降低初始速度，让它们更稳重
            this.vx = (Math.random() - 0.5) * 0.3;
            this.vy = (Math.random() - 0.5) * 0.3;
            this.size = Math.random() * 2 + 1;
            this.alpha = Math.random() * 0.4 + 0.1;
            this.friction = 0.95; // 增加摩擦力，防止乱动
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            
            // 摩擦力衰减速度
            this.vx *= this.friction;
            this.vy *= this.friction;

            // 保持微弱的随机漂浮力
            this.vx += (Math.random() - 0.5) * 0.05;
            this.vy += (Math.random() - 0.5) * 0.05;

            if (this.x < 0 || this.x > width) this.vx *= -1;
            if (this.y < 0 || this.y > height) this.vy *= -1;

            if (mouse.active) {
                const dx = mouse.x - this.x;
                const dy = mouse.y - this.y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                
                if (dist < 250) {
                    // 吸引力逻辑：距离越近，吸引力越平滑
                    const force = (250 - dist) * 0.0005; 
                    this.vx += dx * force;
                    this.vy += dy * force;
                }
            }
        }
        draw() {
            ctx.globalAlpha = this.alpha;
            ctx.fillStyle = '#fdfaf2';
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    function init() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        particles = [];
        for (let i = 0; i < 120; i++) particles.push(new Particle());
    }

    function animate() {
        ctx.fillStyle = '#1a1a1a';
        ctx.fillRect(0, 0, width, height);
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animate);
    }

    // 适配移动端的触摸事件
    function handleTouch(e) {
        e.preventDefault(); // 阻止浏览器默认行为（如长按复制）
        const touch = e.touches[0];
        mouse.x = touch.clientX;
        mouse.y = touch.clientY;
    }

    window.addEventListener('touchstart', (e) => {
        mouse.active = true;
        mouse.startTime = Date.now();
        handleTouch(e);
        prompt.style.opacity = '0.1';
    }, { passive: false });

    window.addEventListener('touchmove', (e) => {
        handleTouch(e);
    }, { passive: false });

    window.addEventListener('touchend', () => {
        const duration = Date.now() - mouse.startTime;
        mouse.active = false;
        mouse.x = -1000; // 移开吸引点
        mouse.y = -1000;
        analyzeMood(duration);
    });

    function analyzeMood(duration) {
        if (duration > 600) {
            feedback.innerText = "感应到你的沉静。此刻，万物陪你静默。";
        } else if (duration < 200) {
            feedback.innerText = "节奏稍快了。试着慢下来，去触碰光。";
        } else {
            feedback.innerText = "感受到你的温度了。";
        }
        setTimeout(() => { prompt.style.opacity = '0.5'; }, 2000);
    }

    init(); animate();
    window.addEventListener('resize', init);
</script>
</body>
</html>
